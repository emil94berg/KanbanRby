@page "/login"
@using KanbanRby.Models
@using KanbanRby.Services.Interfaces
@using Task = System.Threading.Tasks.Task
@inject ISupabaseAuthService SupabaseAuth
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Login</PageTitle>

<div class="home-container auth-container">
    <div class="hero-section">
        <h1 class="hero-title">Welcome Back!</h1>
        <p class="hero-subtitle">Sign in to access your Kanban boards and continue managing your tasks.</p>
    </div>

    <div class="features-section">
        <div class="feature-card">
            @if (_errorMsg)
            {
                <div>
                    <h4 style="color: lightcoral; align-items:center; text-align: center;">Email or password not found...</h4><br/>
                    <p style="color: lightcoral; align-items:center; text-align: center;" >Try again</p>
                </div> 
            }
            <EditForm Model="@_loginModel" OnValidSubmit="@HandleLogin" FormName="LogInForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <InputText @bind-Value="@_loginModel.Email" class="form-control" placeholder="Enter your email"></InputText>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <InputText @bind-Value="@_loginModel.Password" type="password" class="form-control" placeholder="Enter your password"></InputText>
                </div>
                <button type="submit" class="btn btn-primary btn-lg btn-hero">Login →</button>
            </EditForm>

            <div style="margin-top: 1.5rem; text-align: center; padding-top: 1.5rem; border-top: 1px solid #e8e8e8;">
                <p style="color: #666; margin-bottom: 0.75rem;">Don't have an account?</p>
                <button class="btn btn-primary btn-lg btn-hero" @onclick="NavigateToRegister" style="width: 100%; background-color: #6c757d; border-color: #6c757d;">
                    Create Account →
                </button>
            </div>
        </div>
    </div>
    
</div>
@code {
    private LoginModel _loginModel = new();
    private bool _errorMsg;
    
    
    private async Task HandleLogin()
    {
        try
        {
            var session = await SupabaseAuth.LoginUserAsync(_loginModel.Email, _loginModel.Password);
            
            if (session != null)
            {
                Console.WriteLine("Logged in!");
                NavigationManager.NavigateTo("/");
            }
        }
        catch (Exception e)
        {
            //Add error when wrong password etc
            Console.WriteLine("Login failed: " + e.Message);
            _errorMsg = true;
            StateHasChanged();
        }
    }

    private void NavigateToRegister()
    {
        NavigationManager.NavigateTo("/registerAccount");
    }
}
